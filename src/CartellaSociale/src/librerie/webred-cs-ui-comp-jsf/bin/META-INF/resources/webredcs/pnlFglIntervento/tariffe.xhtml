<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:webred="http://java.sun.com/jsf/composite/webred"
	xmlns:webredcs="http://java.sun.com/jsf/composite/webredcs">

	<p:growl id="growl3" life="2000" />
	
	<h:panelGrid columns="2" >
		
		<p:outputLabel value="Unità di misura " />
		<p:selectOneMenu id="selectUnitaDiMisura" style="width:150px" disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
				value="#{fglInterventoBean.datiTariffeInterventoBean.selUnitaMisura}">
			<f:selectItem itemLabel="- seleziona -"  noSelectionOption="true" />	
			<f:selectItems value="#{fglInterventoBean.datiTariffeInterventoBean.lstCsTbUnitaMisuraForInsert}" var="item" itemLabel="#{item.valore}" itemValue="#{item.id}" />
			<p:ajax event="change" update="@(.updateOnUnitaMisuraChange)" process="@this" listener="#{fglInterventoBean.datiTariffeInterventoBean.selectedUnitaMisuraChange(fglInterventoBean.erogazioneInterventoBean)}"/>
		</p:selectOneMenu>	
	
	</h:panelGrid>
	
	<p:spacer height="10px"/>
   
   <p:fieldset legend="Quantità Programmata">
    <h:panelGrid columns="2" width="100%">
   	    <p:selectOneRadio id="flagAssegnazDiminuz" disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
   	    				  value="#{fglInterventoBean.datiTariffeInterventoBean.csIRigaQuotaNew.flagAssegnazDiminuz}" 
	                      styleClass="#{'updateOnUnitaMisuraChange'}" layout="grid" columns="1">
	        <f:selectItems value="#{fglInterventoBean.datiTariffeInterventoBean.tipiQuota}" 
	            var="tipoRigaQuota" 
	            itemValue="#{tipoRigaQuota.codice}" 
	            itemLabel="#{tipoRigaQuota.descrizione} (#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csTbUnitaMisura.valore})" />
	    </p:selectOneRadio>
    
    	<h:panelGrid columns="4" >  
    	
    		<p:outputLabel styleClass="#{'updateOnUnitaMisuraChange'}" 
	    	value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csTbUnitaMisura.valore!=null ? fglInterventoBean.datiTariffeInterventoBean.csIQuota.csTbUnitaMisura.valore : '- seleziona unità di misura -'} " />
			<p:inputText id="inputRigaQuota" styleClass="#{'updateOnAggiungiRigaQuota'}" 
			        disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
					style="width:90px;" value="#{fglInterventoBean.datiTariffeInterventoBean.csIRigaQuotaNew.csIValQuota.valQuota}">
	          		<f:convertNumber maxFractionDigits="2" maxIntegerDigits="8" type="number" />
	         </p:inputText>
    	
		    <p:outputLabel id="labelDataInizio" for="inputDataInizio" value="Dalla data" />
		    <h:panelGroup styleClass="#{'updateOnAggiungiRigaQuota'}">	
				<webred:pnlData id="inputDataInizio" 
				    disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
					dataValue="#{fglInterventoBean.datiTariffeInterventoBean.csIRigaQuotaNew.dataDa}"
					dataPattern="dd/MM/yyyy" 
					dataPatternLabel="(gg/mm/aaaa)" />
		    </h:panelGroup>
		    

		    
	    	<p:outputLabel value="Motivo/Note: " />
			<p:inputText id="inputRigaMotivoNote" styleClass="#{'updateOnAggiungiRigaQuota'}"
					style="text-transform: uppercase; width:200px;"
					disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}" 
					value="#{fglInterventoBean.datiTariffeInterventoBean.csIRigaQuotaNew.csIValQuota.note}" maxlength="4000"/>
			
			<p:spacer width="10"/>
			 <p:commandButton id="buttonAggiungiRigaQuota" title="Aggiungi" value="Aggiungi"
				actionListener="#{fglInterventoBean.datiTariffeInterventoBean.aggiungiRigaQuota()}"
				disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
				process="@parent flagAssegnazDiminuz" icon="ui-icon-circle-plus" update="@(.updateOnAggiungiRigaQuota)"/>    
		
		</h:panelGrid>
		
	</h:panelGrid>
	
	<p:dataTable id="dataTableRigheQuote" styleClass="#{'updateOnAggiungiRigaQuota'}" 
		emptyMessage="Nessun dato da visualizzare" 
		value="#{fglInterventoBean.datiTariffeInterventoBean.lstCsIRigheQuota()}" var="rigaQuota" rowIndexVar="rowIndex" >
		<f:facet name="header">Quote</f:facet>
		<p:column headerText="Tipo" width="20" style="text-align:center;">
			<h:outputText value="#{rigaQuota.flagAssegnazDiminuz eq 'A' ? '+' : (rigaQuota.flagAssegnazDiminuz eq 'D' ? '-' : rigaQuota.flagAssegnazDiminuz)}" />
			<f:facet name="footer">Totale</f:facet>
		</p:column>
		<p:column headerText="Importo" style="text-align:center;">
			<h:outputText value="#{rigaQuota.csIValQuota.valQuota}" />
			<f:facet name="footer">#{fglInterventoBean.datiTariffeInterventoBean.totaleQuote}</f:facet>
		</p:column>
		<p:column headerText="dalla Data" style="text-align:center;">
			<h:outputText value="#{rigaQuota.dataDa}">
				<f:convertDateTime pattern="dd/MM/yyyy"/>
			</h:outputText>
		</p:column>
		<p:column headerText="Motivo/Note">
			<h:outputText value="#{rigaQuota.csIValQuota.note}" />
		</p:column>
		<p:column width="50">
			<p:commandButton id="buttonRimuoviRigaQuota" title="Elimina" 
				actionListener="#{fglInterventoBean.datiTariffeInterventoBean.rimuoviRigaQuota(rigaQuota)}"
				disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
				icon="ui-icon-trash" 
				update="@(.updateOnAggiungiRigaQuota)"
				process="@this" />
		</p:column>
	</p:dataTable>
	</p:fieldset>
	
	<p:spacer height="20px"/>
	
	<h:panelGrid columns="7">
	
		<p:outputLabel value="Tariffa unitaria" />
		<p:inputText id="inputTariffaUnitaria"  
					disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}" 
					style="width: 50px;" value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.tariffa}"
					styleClass="#{'updateOnUnitaMisuraChange'}">
	          		<f:convertNumber maxFractionDigits="2" maxIntegerDigits="8" type="number" />
	          		<p:ajax event="blur" update="@(.updateOnTariffaUnitariaChange)" process="@this" 
	          		        listener="#{fglInterventoBean.erogazioneInterventoBean.onUpdateTariffa(fglInterventoBean.datiTariffeInterventoBean.csIQuota.tariffa)}"/>
	   </p:inputText>
	    <h:outputText value=" € "/>
	    
	    <p:spacer width="10px"/>
		
		<p:outputLabel value="Descrizione Tariffa " />
		<p:inputText id="inputDescrizioneTariffa" 
				disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
				style="text-transform: uppercase; width:200px;" value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.descTariffa}" maxlength="4000"
				styleClass="#{'updateOnUnitaMisuraChange'}"/>

        <p:commandButton id="buttonSelezionaTariffa" value="Seleziona" 
        				 disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
        				 onclick="alert('Funzionalità non implementata');"
                         title="Seleziona da elenco della tabella AR_C_TARIFFA. In caso di selezione riporta anche la descrizione tariffa."  />
        
       </h:panelGrid>
       
       <p:spacer height="20px"/>
       
	   <h:panelGrid columns="9"> 
	
		<h:outputText value="Spesa Prevista  "/>
		<p:inputText id="inputSpesaPrevista" disabled="true" style="width: 50px;"
		     value="#{fglInterventoBean.datiTariffeInterventoBean.spesaPrevista}" 
		     styleClass="#{'updateOnTariffaUnitariaChange updateOnAggiungiRigaQuota updateOnUnitaMisuraChange'}"> 
			<f:convertNumber maxFractionDigits="2" maxIntegerDigits="8" type="number" />
        </p:inputText>
		 
		<h:outputText value=" € di cui"/>
		
		<p:inputText id="inputSpesaPrevistaDiCui" style="width: 50px;"
					 disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
		             value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.compUtente}"> 
			<f:convertNumber maxFractionDigits="2" maxIntegerDigits="8" type="number" />
        </p:inputText>
        
        <h:outputText  value=" € compartecipati dall'utente, con quota " />
        <p:selectOneMenu value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.flagPeriodoComp}"
        				 disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}">
        	<f:selectItem itemLabel="- seleziona -" noSelectionOption="true"/>
        	<f:selectItems value="#{fglInterventoBean.datiTariffeInterventoBean.tipiCadenzaQuota}" var="tipo" itemValue="#{tipo.codice}" itemLabel="#{tipo.descrizione}" />
        </p:selectOneMenu>
        <h:outputText  value="pari a" for="inputCompartecipazioneValore"/>
        <p:inputText id="inputCompartecipazioneValore" 
        	style="text-transform: uppercase; width:50px;"
        	disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}" 
			value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.compUtentePeriodo}">
           		<f:convertNumber maxFractionDigits="2" maxIntegerDigits="8" type="number" />
        </p:inputText>
        <h:outputText value="€"/>
	</h:panelGrid>

	<h:panelGrid columns="3" cellspacing="10">
		<p:outputLabel value="N. accessi al servizio" for="inputNumAccessiAlServizio" />
        <p:spinner id="inputNumAccessiAlServizio" size="4"
                   disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
                   value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csIQuotaRipartiz.nTotAccessiServizio}"/>
	
		<p:spacer/>
		
		<p:outputLabel value="Frequenza del servizio " for="selectFrequenzaDelServizio" />			
		<p:selectOneRadio id="selectFrequenzaDelServizio" layout="grid" columns="1"
						  value="#{fglInterventoBean.datiTariffeInterventoBean.frequenzaAccessoAlServizio}"
						  disabled="#{fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
						  required="true" requiredMessage="'Frequenza del servizio' è un campo obbligatorio"			>
			<f:selectItems value="#{fglInterventoBean.datiTariffeInterventoBean.tipiFrequenzaServizio}" 
	            var="tipoAccesso" 
	            itemValue="#{tipoAccesso.codice}" 
	            itemLabel="#{tipoAccesso.descrizione}" />
	        <p:ajax event="change" update="@(.updateOnFrequenzaDelServizioChange)" process="@this" listener="#{fglInterventoBean.datiTariffeInterventoBean.frequenzaDelServizioChange()}"/>
	    </p:selectOneRadio>
   
		<h:panelGrid columns="4" >
			<p:outputLabel value="Frequenza " for="selectFrequenzaCadenzaDelServizio" />		
			<p:selectOneMenu id="selectFrequenzaCadenzaDelServizio" 
					value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csIQuotaRipartiz.flagPeriodoRipartiz}" 
					styleClass="#{'updateOnFrequenzaDelServizioChange'}"
					disabled="#{fglInterventoBean.datiTariffeInterventoBean.disableInputFrequenzaDelServizio or fglInterventoBean.datiTariffeInterventoBean.solaLettura}">		
	        	<f:selectItem itemLabel="- seleziona -" itemValue="" />
	        	<f:selectItems value="#{fglInterventoBean.datiTariffeInterventoBean.tipiFrequenzaServizioCadenza}" 
	        			var="tipoFrequenza" 
	        			itemValue="#{tipoFrequenza.codice}" 
	        			itemLabel="#{tipoFrequenza.descrizione}" />
	        	<p:ajax event="change" update="@(.updateOnFlagPeriodoRipartizChange)" process="@this" listener="#{fglInterventoBean.datiTariffeInterventoBean.flagPeriodoRipartizChange()}"></p:ajax>
	        </p:selectOneMenu>
		    
		    <p:outputLabel for="inputQuotaFrequenzaServizio" styleClass="#{'updateOnUnitaMisuraChange'}"
		         value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csTbUnitaMisura.valore!=null ? fglInterventoBean.datiTariffeInterventoBean.csIQuota.csTbUnitaMisura.valore : '- seleziona unità di misura -' }" />
		
		        <p:inputText id="inputQuotaFrequenzaServizio" 
		                value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csIQuotaRipartiz.valQuotaPeriodo}" 
			        	styleClass="#{'updateOnFrequenzaDelServizioChange'}" style="width:90px;" 
			        	disabled="#{fglInterventoBean.datiTariffeInterventoBean.disableInputFrequenzaDelServizio or fglInterventoBean.datiTariffeInterventoBean.solaLettura}">        
		        	<f:convertNumber type="number" maxFractionDigits="0"/>
		    </p:inputText>
		    
			<p:outputLabel value="N. giorni/settimana" for="inputNumgiorniSettimana" />			
			<p:spinner id="inputNumgiorniSettimana" 
				value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csIQuotaRipartiz.nGgSettimanali}"
				disabled="#{not fglInterventoBean.datiTariffeInterventoBean.flagPeriodoRipartizEnabled() or fglInterventoBean.datiTariffeInterventoBean.disableInputFrequenzaDelServizio  or fglInterventoBean.datiTariffeInterventoBean.solaLettura}" 
				styleClass="#{'updateOnFlagPeriodoRipartizChange updateOnFrequenzaDelServizioChange'}" size="4" min="0" max="7" />
			
			<p:outputLabel value="Rendiconto" for="selectRendiconto" />
			<p:selectOneRadio id="selectRendiconto" value="#{fglInterventoBean.datiTariffeInterventoBean.csIQuota.csIQuotaRipartiz.flagRendiconto}" 
			        layout="grid" columns="1" required="true" requiredMessage="Rendiconto è un campo obbligatorio"
					disabled="#{fglInterventoBean.datiTariffeInterventoBean.disableInputFrequenzaDelServizio or fglInterventoBean.erogazioneInterventoBean.erogazioniPresenti or fglInterventoBean.datiTariffeInterventoBean.solaLettura}"
					styleClass="#{'updateOnFlagPeriodoRipartizChange updateOnFrequenzaDelServizioChange updateOnListaErogazioniChange'}">
				<f:selectItems value="#{fglInterventoBean.datiTariffeInterventoBean.tipiRendicontazione}" 
		            var="tipoRendicontazione" 
		            itemValue="#{tipoRendicontazione.codice}" 
		            itemLabel="#{tipoRendicontazione.descrizione}" />
		        <p:ajax event="change" update="@(.updateOnFlagRendicontoChange)" process="@this"></p:ajax>    
		    </p:selectOneRadio>
		    
		</h:panelGrid>
	</h:panelGrid>
	
</html>