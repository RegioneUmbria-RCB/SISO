<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:webred="http://java.sun.com/jsf/composite/webred"
	xmlns:webredcs="http://java.sun.com/jsf/composite/webredcs">

<h:head>
	<title>Gestione Progetti</title>	
</h:head>

<h:body>
	<composite:interface componentType="pnlListaPai">
		<composite:attribute name="iPai"
			type="it.webred.cs.jsf.interfaces.IPai" />
		<!--     <composite:attribute name="var" type="java.lang.String" required="false" default="1" /> -->
	</composite:interface>

	<composite:implementation>

		<script type="text/javascript">
		//<![CDATA[
			function onCompletePai(args)
			{
				if (args && !args.validationFailed && args.saved) { 
				//evoluzione-pai	PF('wdgPaiModal').hide(); 
					updateLista();
					removePaiOverlayPanel();
				} 
				else {
					//alert('errori di validazione');					
				}
			}


			function showPaiOverlayPanel(){
				putPaiOverlayPanel( $('#fascicoloTab') );
			}


			function hidePaiOverlayPanel(){
				updateLista();
				removePaiOverlayPanel();
			}
			
		//]]>
		</script>
		<style>
		  .ui-picklist .ui-picklist-list
		  {
		  	width:auto !important;
		  }
		</style>


 	<p:outputPanel id="elencoProgettiContainer">  <!-- evoluzione-pai aggiunto panel contenitore elencoProgettiContainer-->
		
				<h:panelGrid columns="1" cellpadding="0" cellspacing="0"  
					 rendered="#{not cc.attrs.iPai.paiDetailRendered}">
					<p:commandButton value="Nuovo progetto"
						action="#{cc.attrs.iPai.nuovo}" icon="ui-icon-document-b"
						process="@this" update="paiDetailContainer elencoProgettiContainer"
						oncomplete="showPaiOverlayPanel();" >
					</p:commandButton>
				</h:panelGrid>
		
				<!-- INIZIO ELENCO PROGETTI ****************************************************** -->
		
				<p:dataTable widgetVar="dataTableWidgetVar" id="dataTablePaiId"
					var="rowPai" rowIndexVar="rowKeyPai" value="#{cc.attrs.iPai.pais}"
					filteredValue="#{cc.attrs.iPai.filteredPais}" filterDelay="1000"
					paginator="true" paginatorPosition="bottom" rows="10"
					emptyMessage="Nessun progetto corrisponde ai criteri di ricerca"
					rendered="#{not cc.attrs.iPai.paiDetailRendered}"  >
		
					<f:facet name="header">
						<p:outputLabel value="Elenco progetti" />
					</f:facet>
		
					<p:column headerText="ID" filterBy="diarioId" filterMatchMode="exact"
						style="text-align:left;width:70px;">
						<h:outputText value="#{rowPai.diarioId}" />
					</p:column>
		
					<p:column headerText="Tipo progetto" filterBy="csTbTipoPai.id"
						filterOptions="#{cc.attrs.iPai.lstTipoPai}" filterMatchMode="exact">
						<h:outputText value="#{rowPai.csTbTipoPai.descrizione}" />
					</p:column>
		
					<p:column headerText="Data Attivazione"
						style="text-align:center;width:70px;">
						<h:outputText value="#{rowPai.csDDiario.dtAttivazioneDa}">
							<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					
					<p:column headerText="Data Chiusura"
						style="text-align:center;width:70px;">
						<h:outputText value="#{rowPai.csDDiario.dtChiusuraDa}">
							<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
		
					<p:column headerText="Chiuso" filterBy="#{rowPai.closed}"
						filterOptions="#{cc.attrs.iPai.statusOptions}"
						filterMatchMode="exact" filterStyle="width:50px;"
						style="text-align:center;width:70px;">
						<h:outputText value="#{rowPai.closed ? 'sì' : 'no'}" />
					</p:column>
		
					<p:column headerText="Da chiudere" filterBy="shouldBeClosed"
						filterOptions="#{cc.attrs.iPai.statusOptions}"
						filterMatchMode="exact" filterStyle="width:50px;"
						style="text-align:center;width:70px;">
						<h:outputText value="#{rowPai.shouldBeClosed ? 'sì' : 'no'}" />
					</p:column>
		
					<p:column headerText="Da controllare" filterBy="shouldBeChecked"
						filterOptions="#{cc.attrs.iPai.statusOptions}"
						filterMatchMode="exact" filterStyle="width:50px;"
						style="text-align:center;width:70px;">
						<h:outputText value="#{rowPai.shouldBeChecked ? 'sì' : 'no'}" />
					</p:column>
		
					<p:column headerText="Obiettivi" filterBy="txtObiettivi"
						filterMatchMode="contains" filterStyle="width:230px;"
						style="width:250px;">
						<h:outputText value="#{rowPai.txtObiettivi}" />
					</p:column>
		
					<p:column headerText="Azioni" style="text-align:center;" width="180">
						<p:commandButton rendered="#{rowPai.closed}" value="Apri"
							action="#{cc.attrs.iPai.carica}"
							icon="ui-icon-pencil" process="@this"
							update="@form" 
							oncomplete="showPaiOverlayPanel();"
							>
							<!-- evoluzione-pai   update=":#{component.namingContainer.parent.namingContainer.clientId}:dlgPai"   -->
							<f:setPropertyActionListener value="#{rowKeyPai}"
								target="#{cc.attrs.iPai.idxSelected}" />
						</p:commandButton>
						<p:commandButton rendered="#{not rowPai.closed}" value="Modifica" 
							action="#{cc.attrs.iPai.carica}"
							icon="ui-icon-pencil" process="@this"
							update="@form"
							oncomplete="showPaiOverlayPanel();"
							>
<!-- evoluzione-pai  update=":#{component.namingContainer.parent.namingContainer.clientId}:dlgPai" -->
							
							<f:setPropertyActionListener value="#{rowKeyPai}"
								target="#{cc.attrs.iPai.idxSelected}" />
						</p:commandButton>
						<p:commandButton rendered="#{not rowPai.closed}" value="Chiudi"
							action="#{cc.attrs.iPai.caricaChiudi}" icon="ui-icon-close"
							process="@this" 
							update="@form" 
							oncomplete="showPaiOverlayPanel();"
							>
							
							<!-- evoluzione-pai   update=":#{component.namingContainer.parent.namingContainer.clientId}:dlgPai" -->
							
							
							<f:setPropertyActionListener value="#{rowKeyPai}"
								target="#{cc.attrs.iPai.idxSelected}" />
						</p:commandButton>
					</p:column>
		
				</p:dataTable>
		
		
				<!-- FINE ELENCO PROGETTI ****************************************************** -->
		
 	</p:outputPanel>


		<!-- inizio aggiunta evoluzione-pai -->  
        
			<h:panelGrid id="paiDetailContainer" >

				<p:panel id="paiDetailContainer2aaa" rendered="#{cc.attrs.iPai.paiDetailRendered}" >   
				
				    <f:facet name="header">
				        <h:outputText id="nuovProgHeader" value="#{cc.attrs.iPai.modalHeader}" />
				    </f:facet> 
				
				
					 <p:panelGrid id="paiDetail" style="width:100%;" >
			
						<p:row>
							<p:column>
								<h:outputLabel for="tipoProgetto" value="Tipo Progetto*" />
							</p:column>
							<p:column colspan="3">
								<p:selectOneMenu id="tipoProgetto"
											value="#{cc.attrs.iPai.selectedPai.csTbTipoPai.id}"
											disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}">
											<f:selectItems value="#{cc.attrs.iPai.lstTipoPai}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
					
						<p:row>
							<p:column>
								<h:outputLabel for="dataAttivazione" value="Data Attivazione*" />
							</p:column>
							<p:column colspan="3">
								<webred:pnlData id="dataAttivazione"
									dataValue="#{cc.attrs.iPai.selectedPai.csDDiario.dtAttivazioneDa}"
									dataPattern="dd/MM/yyyy" dataReq="true"
									dataReqMes="Data Attivazione è un campo obbligatorio"
									dataValMes="Data Attivazione non valida"
									dataConMes="Data attivazione non valida"
									dataPatternLabel="(gg/mm/aaaa)" yearRange="c-1:c+5"
									disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}" />
							</p:column>
						</p:row>
						
						<p:row>
							<p:column>
								<h:outputLabel for="dataChiusura" value="Data Chiusura*" />
							</p:column>
							<p:column colspan="3">
								<webred:pnlData id="dataChiusura"
									dataValue="#{cc.attrs.iPai.selectedPai.csDDiario.dtChiusuraDa}"
									dataPattern="dd/MM/yyyy" 
									dataReq="true"
									dataReqMes="Data Chiusura è un campo obbligatorio"
									dataValMes="Data Chiusura non valida"
									dataConMes="Data chiusura non valida"
									dataPatternLabel="(gg/mm/aaaa)" yearRange="c-1:c+5"
									disabled="#{cc.attrs.iPai.selectedPai.closed}" />
							</p:column>
						</p:row>
		
						<p:row>
							<p:column>
								<h:outputLabel for="obiettiviBreve"
									value="Obiettivi di breve termine**" />
							</p:column>
							<p:column>
								<p:inputTextarea id="obiettiviBreve" rows="4" cols="50"
									value="#{cc.attrs.iPai.selectedPai.obiettiviBreve}"
									disabled="#{cc.attrs.iPai.selectedPai.closed}" />
							</p:column>
							<p:column>
								<h:outputLabel for="raggiuntiBreve" value="Raggiunti" />
							</p:column>
							<p:column>
								<p:selectOneRadio id="raggiuntiBreve"
									value="#{cc.attrs.iPai.selectedPai.raggiuntiBreve}"
									layout="pageDirection"
									disabled="#{cc.attrs.iPai.selectedPai.closed}">
									<f:selectItem itemLabel="No" itemValue="1" />
									<f:selectItem itemLabel="Parzialmente" itemValue="2" />
									<f:selectItem itemLabel="Sì" itemValue="3" />
								</p:selectOneRadio>
							</p:column>
						</p:row>
		
						<p:row>
							<p:column>
								<h:outputLabel for="obiettiviMedio"
									value="Obiettivi di medio termine**" />
							</p:column>
							<p:column>
								<p:inputTextarea id="obiettiviMedio" rows="4" cols="50"
									value="#{cc.attrs.iPai.selectedPai.obiettiviMedio}"
									disabled="#{cc.attrs.iPai.selectedPai.closed}" />
							</p:column>
							<p:column>
								<h:outputLabel for="raggiuntiMedio" value="Raggiunti" />
							</p:column>
							<p:column>
								<p:selectOneRadio id="raggiuntiMedio"
									value="#{cc.attrs.iPai.selectedPai.raggiuntiMedio}"
									layout="pageDirection"
									disabled="#{cc.attrs.iPai.selectedPai.closed}">
									<f:selectItem itemLabel="No" itemValue="1" />
									<f:selectItem itemLabel="Parzialmente" itemValue="2" />
									<f:selectItem itemLabel="Sì" itemValue="3" />
								</p:selectOneRadio>
							</p:column>
						</p:row>
						
						<p:row>
							<p:column>
								<h:outputLabel for="obiettiviLungo"
									value="Obiettivi di lungo termine**" />
							</p:column>
							<p:column>
								<p:inputTextarea id="obiettiviLungo" rows="4" cols="50"
									value="#{cc.attrs.iPai.selectedPai.obiettiviLungo}"
									disabled="#{cc.attrs.iPai.selectedPai.closed}" />  
							</p:column>
							<p:column>
								<h:outputLabel for="raggiuntiLungo" value="Raggiunti" />
							</p:column>
							<p:column>
								<p:selectOneRadio id="raggiuntiLungo"
									value="#{cc.attrs.iPai.selectedPai.raggiuntiLungo}"
									layout="pageDirection"
									disabled="#{cc.attrs.iPai.selectedPai.closed}">
									<f:selectItem itemLabel="No" itemValue="1" />
									<f:selectItem itemLabel="Parzialmente" itemValue="2" />
									<f:selectItem itemLabel="Sì" itemValue="3" />
								</p:selectOneRadio>
							</p:column>
						</p:row>
		
						<p:row>
							<p:column>
								<h:outputLabel value="Verifica ogni" />
							</p:column>
							<p:column>
								<p:spinner value="#{cc.attrs.iPai.selectedPai.verificaOgni}"
									min="0" size="5"
									disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}" />
								<p:spacer width="20" />
								<p:selectOneMenu style="vertical-align: middle;"
									value="#{cc.attrs.iPai.selectedPai.verificaUnitaMisura}"
									disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}">
									<f:selectItem itemLabel="Giorni" itemValue="Giorni" />
									<f:selectItem itemLabel="Settimane" itemValue="Settimane" />
									<f:selectItem itemLabel="Mesi" itemValue="Mesi" />
									<f:selectItem itemLabel="Anni" itemValue="Anni" />
								</p:selectOneMenu>
							</p:column>
							<p:column colspan="2">
								<p:spacer />
							</p:column>
						</p:row>
		
						<p:row>
							<p:column>
								<h:outputLabel for="dataUltimoMonitoraggio"
									value="Data ultimo monitoraggio" />
							</p:column>
							<p:column>
								<webred:pnlData id="dataUltimoMonitoraggio"
									dataValue="#{cc.attrs.iPai.selectedPai.dataMonitoraggio}"
									dataPattern="dd/MM/yyyy"
									dataValMes="Data ultimo monitoraggio non valida"
									dataConMes="Data ultimo monitoraggio non valida"
									dataPatternLabel="(gg/mm/aaaa)" yearRange="c-1:c+5"
									disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}" />
							</p:column>
							<p:column colspan="2">
								<p:spacer />
							</p:column>
						</p:row>

						<p:row
							rendered="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}">
							<p:column rowspan="2">
								<h:outputText value="Motivo della chiusura*" />
							</p:column>
							<p:column colspan="3">
								<p:selectOneMenu
									value="#{cc.attrs.iPai.selectedPai.motivoChiusura}"
									rendered="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}"
									disabled="#{cc.attrs.iPai.selectedPai.closed}" required="true"
									requiredMessage="E' necessario indicare il motivo di chiusura">
									<f:selectItem itemLabel="specificare un motivo di chiusura"
										noSelectionOption="true" />
									<f:selectItem itemLabel="Progetto chiuso"
										itemValue="Progetto chiuso" />
									<f:selectItem itemLabel="Non collaborazione"
										itemValue="Non collaborazione" />
									<f:selectItem itemLabel="Percorso in autonomia"
										itemValue="Percorso in autonomia" />
									<f:selectItem itemLabel="Deceduto / Trasferito / Non reperibile"
										itemValue="Deceduto / Trasferito / Non reperibile" />
									<f:selectItem itemLabel="Passaggio ad altro servizio/ente"
										itemValue="Passaggio ad altro servizio/ente" />
									<f:selectItem itemLabel="Altro (specificare):" itemValue="Altro" />
								</p:selectOneMenu>
							</p:column>
						</p:row>

				 		<p:row
							rendered="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}">
							<p:column colspan="3">
								<p:inputTextarea rows="2"
									value="#{cc.attrs.iPai.selectedPai.motivoChiusuraSpec}"
									disabled="#{cc.attrs.iPai.selectedPai.closed}" />
							</p:column>
						</p:row>  
						 
					</p:panelGrid>
					
					
					
					<p:spacer height="10px;" />
					<br />
					<h:outputLabel value="* campi obbligatori"
						style="font-weight:bold;font-style:italic;font-size:11px;" />
					<br />
					<h:outputLabel value="** compilare almeno uno degli obiettivi"
						style="font-weight:bold;font-style:italic;font-size:11px;" />
					<br />
								
					<p:spacer width="40px;" />
					<br />
					
		
	<h:panelGrid id="paiTabViewContainer"> 			 
			 
			<p:panelGrid id="relazioni_picklist_panel" columns="1" style="width:100%"
				widgetVar="wv_relazioni_picklist_panel"
				rendered="#{cc.attrs.iPai.onUpdateRelazioni}">
				<f:facet name="header">
					<p:outputLabel value="Associazione di altre attività al PAI" />
				</f:facet>
				<f:facet name="footer">
					<h:panelGroup>
						<p:commandButton value="conferma"
							process="relazioni_picklist_panel" 
							action="#{cc.attrs.iPai.setOnUpdateRelazioni(false)}" 
							update="@([id$=paiTabViewContainer])"  />
						<p:commandButton value="annulla" process="@this" 
							update="relazioni_picklist_panel:@parent"
							action="#{cc.attrs.iPai.setOnUpdateRelazioni(false)}"  />
					</h:panelGroup>
				</f:facet>
				<p:pickList id="relazioni_picklist" style="width:100%"
					value="#{cc.attrs.iPai.picklistRelazioni}" var="v_relazione"
					itemLabel="#{v_relazione.labelConcatAll}"
					itemValue="#{v_relazione}" showSourceFilter="true"
					showTargetFilter="false" filterMatchMode="contains"
					converterMessage="Errore di conversione"
					converter="#{cc.attrs.iPai.picklistRelazioniConverter}"
					showCheckbox="true">
					<f:facet name="sourceCaption">Disponibili</f:facet>
					<f:facet name="targetCaption">Collegate al progetto PAI</f:facet>
					<p:column headerText="Data" style="width:20%">					
						<h:outputText
							value="#{v_relazione.relazione.csDDiario.dtAmministrativa}">
							<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column headerText="Situazione" style="width:50%">
						s/a:&sp;
						<h:outputText 
							value="#{v_relazione.relazione.situazioneAmb!=null and v_relazione.relazione.situazioneAmb.length()>20 ? v_relazione.relazione.situazioneAmb.substring(0,20).concat('...') : v_relazione.relazione.situazioneAmb}" />
						<br/>
						s/p:&sp;
						<h:outputText
							value="#{v_relazione.relazione.situazioneParentale!=null and v_relazione.relazione.situazioneParentale.length()>20 ? v_relazione.relazione.situazioneParentale.substring(0,20).concat('...') : v_relazione.relazione.situazioneParentale}" />
						<br/>
						s/s:&sp;
						<h:outputText
							value="#{v_relazione.relazione.situazioneSanitaria!=null and v_relazione.relazione.situazioneSanitaria.length()>20 ? v_relazione.relazione.situazioneSanitaria.substring(0,20).concat('...'): v_relazione.relazione.situazioneSanitaria}" />
					</p:column>
					<p:column headerText="Proposta" style="width:30%">
						prop.:&sp;
						<h:outputText
							value="#{v_relazione.relazione.proposta!=null and (v_relazione.relazione.proposta.length()>20) ? v_relazione.relazione.proposta.substring(0,20).concat('...') : v_relazione.relazione.proposta}" />
					</p:column>
				</p:pickList>
			</p:panelGrid>
					
		
		
		
		
			<p:panelGrid id="interventi_picklist_panel" columns="1" style="width:100%"
				widgetVar="wv_interventi_picklist_panel"
				rendered="#{cc.attrs.iPai.onUpdateInterventi}">
				<f:facet name="header">
					<p:outputLabel value="Associazione di altri interventi al PAI" />
				</f:facet>
				<f:facet name="footer">
					<h:panelGroup>
						<p:commandButton value="conferma"
							process="interventi_picklist_panel" 
							update="@([id$=paiTabViewContainer])"  
							action="#{cc.attrs.iPai.setOnUpdateInterventi(false)}"  />
						<p:commandButton value="annulla" 
							process="@this" 
							update="interventi_picklist_panel:@parent"
							action="#{cc.attrs.iPai.setOnUpdateInterventi(false)}" />
					</h:panelGroup>
				</f:facet>
				
				<p:pickList id="interventi_picklist" style="width:100%" 
					value="#{cc.attrs.iPai.picklistInterventi}" var="v_intervento"
					itemLabel="#{v_intervento.labelConcatAll}"
					itemValue="#{v_intervento}" showSourceFilter="true"
					showTargetFilter="false" filterMatchMode="contains"
					converterMessage="Errore di conversione"
					converter="#{cc.attrs.iPai.picklistInterventiConverter}"
					showCheckbox="true">
					<f:facet name="sourceCaption">Disponibili</f:facet>
					<f:facet name="targetCaption">Collegati al progetto PAI</f:facet>
					<p:column headerText="Tipo">						
						<h:outputText value="#{v_intervento.descTipoIntervento}" />
					</p:column>
					<p:column>
					categ.:&sp;
						<h:outputText
							value="#{v_intervento.relSettCsocTipoInter.csRelSettoreCatsoc.csCCategoriaSociale.descrizione}" />
					<br/>
					modal.:&sp;
						<h:panelGrid columns="3" styleClass="#{cc.attrs.styleClass}">
							<h:panelGroup>
								<h:outputText value="Rinnovo"
									rendered="#{v_intervento.flagPrimaErRinnovo eq 'R'}" />
								<h:outputText value="Prima Erogazione"
									rendered="#{v_intervento.flagPrimaErRinnovo eq 'P'}" />
							</h:panelGroup>
						</h:panelGrid>
					</p:column>
					<p:column style="text-align:center;">
						inizio:&sp;
						<h:panelGroup rendered="#{v_intervento.inizioDa ne NULL}">
							<h:outputText value="Dal " rendered="#{v_intervento.inizioA ne NULL}" />
							<h:outputText value="#{v_intervento.inizioDa}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
						<h:panelGroup rendered="#{v_intervento.inizioA ne NULL}">
							<h:outputText value=" al " />
							<h:outputText value="#{v_intervento.inizioA}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
					<br/>
					fine:&sp;
						<h:panelGroup rendered="#{v_intervento.fineDa ne NULL}">
							<h:outputText value="Dal " rendered="#{v_intervento.fineA ne NULL}" />
							<h:outputText value="#{v_intervento.fineDa}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
						<h:panelGroup rendered="#{v_intervento.fineA ne NULL}">
							<h:outputText value=" al " />
							<h:outputText value="#{v_intervento.fineA}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
					</p:column> 
					<p:column>
					richied.:&sp;
						<h:outputText
							value="#{v_intervento.relSettCsocTipoInter.csRelSettoreCatsoc.csOSettore.nome}" />
					
					</p:column>
					
				</p:pickList>
			</p:panelGrid>
		 
		
	
	<p:tabView 	binding="#{cc.attrs.iPai.tabview}" id="paitabview"
			    rendered="#{not cc.attrs.iPai.onUpdateInterventi and not cc.attrs.iPai.onUpdateRelazioni}" 
				orientation="left" styleClass="paiDetailTabLeft" 
				cache="false"  >
<!--         <p:tab title="Attività professionali"> 

			<p:panel id="dataTableRelazioni_panel"
				widgetVar="wv_dataTableRelazioni_panel"
				rendered="#{not cc.attrs.iPai.onUpdateInterventi and not cc.attrs.iPai.onUpdateRelazioni}">
				<p:dataTable id="dataTableRelazioni" var="rowRel"
					rowIndexVar="rowKeyRel"
					emptyMessage="Nessuna attività professionale associata al progetto"
					value="#{cc.attrs.iPai.picklistRelazioni.target}" paginator="false"
					widgetVar="wv_dataTableRelazioni">

					<f:facet name="header">
						<p:outputLabel value="Attività professionali" />
					</f:facet>
					<f:facet name="footer">
						<p:commandButton value="Collega attività"
							disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}"
							action="#{cc.attrs.iPai.setOnUpdateRelazioni(true)}" 
							process="@this" 
							update="@([id$=paiTabViewContainer])" />   
					evoluzione-pai   update=":#{component.namingContainer.parent.namingContainer.clientId}:dlgPai"  
					</f:facet>

					<p:column headerText="Data" width="60">
						<h:outputText
							value="#{rowRel.relazione.csDDiario.dtAmministrativa}">
							<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column headerText="Sit. socio ambientale">
						<h:outputText
							value="#{rowRel.relazione.situazioneAmb!=null and rowRel.relazione.situazioneAmb.length()>20 ? rowRel.relazione.situazioneAmb.substring(0,20).concat('...') : rowRel.relazione.situazioneAmb}" />
					</p:column>
					<p:column headerText="Sit. socio parentale">
						<h:outputText
							value="#{rowRel.relazione.situazioneParentale!=null and rowRel.relazione.situazioneParentale.length()>20 ? rowRel.relazione.situazioneParentale.substring(0,20).concat('...') : rowRel.relazione.situazioneParentale}" />
					</p:column>
					<p:column headerText="Sit. socio sanitaria">
						<h:outputText
							value="#{rowRel.relazione.situazioneSanitaria!=null and rowRel.relazione.situazioneSanitaria.length()>20 ? rowRel.relazione.situazioneSanitaria.substring(0,20).concat('...'): rowRel.relazione.situazioneSanitaria}" />
					</p:column>
					<p:column headerText="Proposta">
						<h:outputText
							value="#{rowRel.relazione.proposta!=null and (rowRel.relazione.proposta.length()>20) ? rowRel.relazione.proposta.substring(0,20).concat('...') : rowRel.relazione.proposta}" />
					</p:column>
				</p:dataTable>
			</p:panel>

			<p:spacer width="10px;" /> 

        </p:tab> -->
        
        
<!--         <p:tab title="Interventi associati"  >
			
			<p:panel id="dataTableInterventi_panel"
				widgetVar="wv_dataTableInterventi_panel"
				rendered="#{not cc.attrs.iPai.onUpdateInterventi and not cc.attrs.iPai.onUpdateRelazioni}">
				
				 
				
			      <p:dataTable id="dataTableInterventi" var="int" rowIndexVar="rowKeyRel"
					emptyMessage="Nessun intervento associato al progetto"
					value="#{cc.attrs.iPai.picklistInterventi.target}" paginator="false">

					<f:facet name="header">
						<p:outputLabel value="Interventi associati" />
					</f:facet>
					<f:facet name="footer">
						<p:commandButton value="Collega interventi"
							disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}"
							action="#{cc.attrs.iPai.setOnUpdateInterventi(true)}" 
							process="@this"  
							update="@([id$=paiTabViewContainer])" />
					evoluzione-pai   update=":#{component.namingContainer.parent.namingContainer.clientId}:dlgPai"  
					</f:facet>
					<p:column>
						<f:facet name="header">Tipo</f:facet>
						<h:outputText value="#{int.descTipoIntervento}" />
					</p:column>
					<p:column>
						<f:facet name="header">Categoria</f:facet>
						<h:outputText
							value="#{int.relSettCsocTipoInter.csRelSettoreCatsoc.csCCategoriaSociale.descrizione}" />
					</p:column>
					<p:column headerText="Modalità">
						<h:panelGrid columns="3" styleClass="#{cc.attrs.styleClass}">
							<h:panelGroup>
								<h:outputText value="Rinnovo"
									rendered="#{int.flagPrimaErRinnovo eq 'R'}" />
								<h:outputText value="Prima Erogazione"
									rendered="#{int.flagPrimaErRinnovo eq 'P'}" />
							</h:panelGroup>
						</h:panelGrid>
					</p:column>
					<p:column headerText="Data Inizio Erogazione"
						style="text-align:center;">
						<h:panelGroup rendered="#{int.inizioDa ne NULL}">
							<h:outputText value="Dal " rendered="#{int.inizioA ne NULL}" />
							<h:outputText value="#{int.inizioDa}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
						<h:panelGroup rendered="#{int.inizioA ne NULL}">
							<h:outputText value=" al " />
							<h:outputText value="#{int.inizioA}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
					</p:column>
					<p:column headerText="Data Fine Erogazione"
						style="text-align:center;">
						<h:panelGroup rendered="#{int.fineDa ne NULL}">
							<h:outputText value="Dal " rendered="#{int.fineA ne NULL}" />
							<h:outputText value="#{int.fineDa}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
						<h:panelGroup rendered="#{int.fineA ne NULL}">
							<h:outputText value=" al " />
							<h:outputText value="#{int.fineA}">
								<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
							</h:outputText>
						</h:panelGroup>
					</p:column>
					<p:column headerText="Una tantum" style="text-align:center;"
						width="10px;">
						<h:panelGroup>
							<p:graphicImage id="imgTantumSi" rendered="#{int.flagUnatantum}"
								title="Si" value="#{resource['webredcs/img/check.png']}" />
						</h:panelGroup>
					</p:column>
					<p:column headerText="Settore Richiedente">
						<h:outputText
							value="#{int.relSettCsocTipoInter.csRelSettoreCatsoc.csOSettore.nome}" />
					</p:column>
					
				</p:dataTable>
			</p:panel> 

        </p:tab> -->
        
        
        
        
        <p:tab title="Collega interventi">
			<!-- INIZIO NUOVO INTERVENTO  evoluzione-pai -->
			 
			<p:panel id="dataTableInterventi_panel">
								 	<h:panelGrid id="paiNuovoIntervento" columns="1" >  
		 	
								<p:panel id="panelIntervento" header="Proposta Intervento"> 
						 	
									<!-- inizio 	evoluzione-pai 	   --> 
										<f:metadata>
											<ui:param name="tipoIntTreeViewMetadataPai"  value="#{cc.attrs.iPai.tipoInterventoManBean}" />
										</f:metadata>    
											
										<ui:include
											src="/jsp/protected/treeTipoIntervento/tipoInterventoTreePai.xhtml">
											<ui:param name="id" value="panelSearchTipoInterventoPai" /> 
											<ui:param name="tipoIntTreeView" value="#{cc.attrs.iPai.tipoInterventoManBean}" />
											<ui:param name="esciActionUpdate" value="panelSearchTipoInterventoPai" />
										</ui:include>  
										 
										
										
										
								<webredcs:pnlFglIntervento id="paiDlgFglInt" styleClass=""
									widgetVar="pnlFglInterventoNuovoPaiWidgetVar"
									salvaActionUpdate = ":#{p:component('panelSearchTipoInterventoPai')}" 
									esciActionUpdate=":#{p:component('panelSearchTipoInterventoPai')}" />
						
						
						
						
						<p:commandButton id="btnNuovoInteverntoPai" process="@this" value="Nuovo Intervento" title="Nuovo Intervento"
							action="#{cc.attrs.iPai.aggiungiTipoInterventoButton()}"
							oncomplete="if(args &amp;&amp; args.interventoSelezionato){  updatePaiDlgFglInt(); PF('pnlFglInterventoNuovoPaiWidgetVar').show(); } " 
							icon="ui-icon-document-b" />
						<p:remoteCommand id="rmtBtnNuovoInteverntoPai"
									 name="updatePaiDlgFglInt" process="@this" 
									 update="paiDlgFglInt:frmDlgFglInterventi" />
									
									<!-- fine 	evoluzione-pai 	   --> 
						
						 	</p:panel>
				 	
				 	
				 	</h:panelGrid>
					
					<h:panelGrid columns="1">
					
					<!--INIZIO  TABELLA LISTA INTERVENTI ASSOCIATI AL PAI   -->
					<p:dataTable id="paiDataTableInterventi" 
								 emptyMessage="Nessun intervento associato." 
								 value="#{cc.attrs.iPai.targetDatiInterventoBean}" 
								 var="int" 
								 rowIndexVar="rowIndex" 
								 rows="10"
								 paginator="true">
									<f:facet name="header">Lista Interventi</f:facet>
					 
									<p:column>
										<f:facet name="header">Tipo</f:facet>
										<h:outputText value="#{int.descTipoIntervento}" />
									</p:column>
									<p:column>
										<f:facet name="header">Categoria</f:facet>
										<h:outputText value="#{int.relSettCsocTipoInter.csRelSettoreCatsoc.csCCategoriaSociale.descrizione}" />
									</p:column>
								 	<p:column headerText="Modalità">
										<h:panelGrid columns="3" styleClass="#{cc.attrs.styleClass}">
											<h:panelGroup>
												<h:outputText value="Rinnovo" rendered="#{int.flagPrimaErRinnovo eq 'R'}" />
												<h:outputText value="Prima Erogazione" rendered="#{int.flagPrimaErRinnovo eq 'P'}" />
											</h:panelGroup>
										</h:panelGrid>
									</p:column>
									<p:column headerText="Data Inizio Erogazione" style="text-align:center;">
										<h:panelGroup rendered="#{int.inizioDa ne NULL}">
											<h:outputText value="Dal " rendered="#{int.inizioA ne NULL}" />
											<h:outputText value="#{int.inizioDa}">
												<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
											</h:outputText>
										</h:panelGroup>
										<h:panelGroup rendered="#{int.inizioA ne NULL}">
											<h:outputText value=" al " />
											<h:outputText value="#{int.inizioA}">
												<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
											</h:outputText>
										</h:panelGroup>
									</p:column>
									<p:column headerText="Data Fine Erogazione" style="text-align:center;">
										<h:panelGroup rendered="#{int.fineDa ne NULL}">
											<h:outputText value="Dal " rendered="#{int.fineA ne NULL}" />
											<h:outputText value="#{int.fineDa}">
												<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
											</h:outputText>
										</h:panelGroup>
										<h:panelGroup rendered="#{int.fineA ne NULL}">
											<h:outputText value=" al " />
											<h:outputText value="#{int.fineA}">
												<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
											</h:outputText>
										</h:panelGroup>
									</p:column>
									<p:column headerText="Una tantum" style="text-align:center;" width="10px;">
										<h:panelGroup>
											<p:graphicImage id="imgTantumSi" rendered="#{int.flagUnatantum}" title="Si" value="#{resource['webredcs/img/check.png']}" />
										</h:panelGroup>
									</p:column>
									<p:column headerText="Settore Richiedente">
										<h:outputText value="#{int.relSettCsocTipoInter.csRelSettoreCatsoc.csOSettore.nome}" />
									</p:column> 
					
					</p:dataTable>
					<!--FINE  TABELLA LISTA INTERVENTI ASSOCIATI AL PAI   -->
					</h:panelGrid>
					
					<h:panelGrid columns="1">
								<p:commandButton value="Collega interventi"
									disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}"
									action="#{cc.attrs.iPai.setOnUpdateInterventi(true)}" 
									process="@this"  
									update="@([id$=paiTabViewContainer])" />
				 	</h:panelGrid>
							

			
			</p:panel>

			
			<!-- FINE NUOVO INTERVENTO evoluzione-pai -->			
					

        </p:tab>
        
        <p:tab title="Collega attività" >
        
        
        	<!-- inizio evoluzione-pai   -->
			<p:panel id="dataTableRelazioni_panel">
					
			 	<h:panelGrid columns="1" >
		           <webredcs:pnlRelazioni iRelazioni="#{fascicoloBean.relazioniBean}" iDiarioDocs="#{diarioDocsMan}" styleClass="noBorder" var="propostaAttivita" /> 
			 	</h:panelGrid> 
	       
			 	<h:panelGrid columns="1" >
			 	
							<p:commandButton value="Collega attività"
								disabled="#{cc.attrs.iPai.selectedPai.closed or cc.attrs.iPai.onClosing}"
								action="#{cc.attrs.iPai.setOnUpdateRelazioni(true)}" 
								process="@this" 
								update="@([id$=paiTabViewContainer])" />   
			 	</h:panelGrid>
       
			</p:panel>
			<!-- fine evoluzione-pai -->
        </p:tab>
    </p:tabView>
	
	
	 <!--
	 
	 	<h:outputText value="dummyDialog widgetVar PF" />  
 	<p:dialog dynamic="true" modal="true" id="dummyDialog"    width="1024" height="800"
				closable="true"  
				appendToBody="true"
				widgetVar="dummyDialog" > 
				
				
					<p:wizard widgetVar="wvar_wizard" id="wizard" 
										backLabel="Indietro" nextLabel="Avanti" showNavBar="true" showStepStatus="true" 	  > 
										<p:tab id="tab_attività" title="Attività" titletip=""></p:tab> 
										</p:wizard>
				
				</p:dialog>   
		<p:commandButton id="asdads"  onclick=" PF('dummyDialog').show(); " ></p:commandButton>
		
		
-->	 
	
	</h:panelGrid>
	
	
	
		
					
		<!--  Salva esci -->
					<p:spacer height="10px;" />
					<br />
		
					<h:panelGroup>				
						<p:remoteCommand name="updateLista" process="@this" update=":#{p:component('dataTablePaiId')}" />
						
						<p:commandButton value="Salva" rendered="#{not cc.attrs.iPai.onClosing}"
							disabled="#{cc.attrs.iPai.selectedPai.closed}"
							actionListener="#{cc.attrs.iPai.salva}"
							process="@form"
							oncomplete="onCompletePai(args)" 
							update="@form" />  
						<p:commandButton value="Chiudi progetto" rendered="#{cc.attrs.iPai.onClosing}"
							disabled="#{cc.attrs.iPai.selectedPai.closed}"
							actionListener="#{cc.attrs.iPai.chiudi}"
							process="@form"
							oncomplete="onCompletePai(args)"
							update="@form" />					
						<p:commandButton value="Annulla" oncomplete="confermaEsciDettaglioPai.show()"
										 process="@this" />
							
						<p:messages for="messagesPai" closable="true" showDetail="true" showSummary="true" autoUpdate="true" />
					</h:panelGroup>
		
					<p:confirmDialog header="Conferma uscita" widgetVar="confermaEsciDettaglioPai"
						severity="alert" closable="false" appendTo="@(body)"
						message="I dati non salvati saranno persi: continuare?">
						<table border="0" width="100%">
							<tr>
								<td style="text-align: center;">
									<p:commandButton value="SÌ"
										onclick="PF('confermaEsciDettaglioPai').hide();"
										process="@this" 
										actionListener="#{cc.attrs.iPai.initializeData}"
										update="@form"
										oncomplete="hidePaiOverlayPanel();"  /> 
									<p:commandButton value="NO" 
										onclick="PF('confermaEsciDettaglioPai').hide();" type="button" />
								</td>
							</tr>
						</table>
					</p:confirmDialog>
		
					<br />
					<p:spacer width="40px;" />
				
				</p:panel>
					
					 
			</h:panelGrid>
			

			
			
		<!-- fine aggiunta evoluzione-pai -->
		
		

	</composite:implementation>

</h:body>

</html>