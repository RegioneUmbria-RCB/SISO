<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:webredcs="http://java.sun.com/jsf/composite/webredcs"
	xmlns:webred="http://java.sun.com/jsf/composite/webred">

<ui:composition template="/jsp/protected/layout/layout.xhtml">

	<ui:define name="content">
	   
       <h:form id="frmSalva"> 		
        <p:outputPanel rendered="#{!schedaBean.attivaSalvataggio and !schedaBean.disableModificaCartella}">
	        <div class="ui-message-warn"  >
			    <h:panelGrid columns="3">
				    <span class="ui-messages-warn-icon"/>
				    <span class="ui-message-error-detail">
				    	La cartella è attualmente aperta in modalità di VISUALIZZAZIONE: eventuali modifiche non verranno salvate." Per modificare i dati inseriti attivare la "Modalità Modifica"  
				    </span>
				   
				 	<h:panelGrid id="modifica" rendered="#{schedaBean.modificaButt}">
						<p:commandButton value="Attiva" process="@this" disabled="#{schedaBean.disableModificaCartella}"
							actionListener="#{schedaBean.modifica()}" update=":header,@form,:schedaPICForm">
						<p:confirm header="Conferma" message="Entrare in 'modalità modifica'?" icon="ui-icon-alert"/>
						</p:commandButton>
					</h:panelGrid>
					</h:panelGrid>
			</div>
		</p:outputPanel> 
	   
		<p:tabView id="#{schedaBean.idTabScheda}" >

			<p:tab id="tabAnagrafica" title="Anagrafica" rendered="#{schedaBean.renderTabAnagrafica}" >

					<h:panelGrid id="pnlGrid1" styleClass="span-20" columns="1">
					    <h:panelGroup rendered="#{schedaBean.identificativoScheda!=null}">
					    	<h:outputText value="Num.Identificativo Cartella: #{schedaBean.identificativoScheda}" style="font-weight:bold;" />
							<p:spacer height="20"/>
					    </h:panelGroup>
	
						<webredcs:pnlAna id="pnlDatAna" panelStyleClass="noBorder"
							iDatiAna="#{anagraficaBean}" disableModifica="#{schedaBean.disableModificaCartella}"/>
					</h:panelGrid>
					
					<webredcs:pnlSoggCatSociale iSoggCatSociale="#{anagraficaBean.soggCatSocialeBean}" salvaActionUpdate=":#{p:component(schedaBean.idTabScheda)}"/>
				
			</p:tab>
			<p:tab id="tabParenti" title="Risorse" rendered="#{schedaBean.renderTabParenti}">
					
					<h:panelGrid columns="1">
						<h:outputText value="Nucleo familiare come da anagrafe comunale" style="font-weight: bold;"/>	
						<p:spacer height="10"/>
					</h:panelGrid>
			
					<p:dataTable emptyMessage="Nessun elemento trovato" id="tblComponentiGit"
						var="compGit" value="#{parentiBean.lstComponentiGit}" rowIndexVar="rowIndex">
			
						<p:column headerText="Cognome">
							<h:outputText value="#{compGit.compGit.cognome}" />
						</p:column>
						
						<p:column headerText="Nome">
							<h:outputText value="#{compGit.compGit.nome}" />
						</p:column>
			
						<p:column headerText="Data nascita" width="40" style="text-align:center;">
							<h:outputText value="#{compGit.compGit.dataNascita}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>
						
						<p:column headerText="Sesso" width="20" style="text-align:center;">
							<h:outputText   rendered="#{compGit.compGit.sesso ne 'F' and compGit.compGit.sesso ne 'M'}" value="#{compGit.compGit.sesso}" />
							<p:graphicImage rendered="#{compGit.compGit.sesso eq 'F'}" title="Donna" value="/images/female.png" height="20"/>
			            	<p:graphicImage rendered="#{compGit.compGit.sesso eq 'M'}" title="Uomo" value="/images/male.png" height="20"/>
						</p:column>
						
						<p:column headerText="Relazione">
							<h:panelGroup rendered="#{!compGit.compGit.parentelaValida}">						
								<p:graphicImage value="/images/attention.png" title="La relazione si riferisce all'intestatario della scheda anagrafica (diverso dal titolare della cartella corrente)"
								height="15px" /><p:spacer width="10px"/>
							</h:panelGroup>	
							<h:outputText value="#{compGit.compGit.csTbTipoRapportoCon.descrizione}" />
						</p:column>
						
						<p:column headerText="" style="text-align:center;">
							<p:graphicImage value="/images/new-doc.png" title="Sono presenti dati aggiornati"
								height="20px" rendered="#{'1' eq compGit.compGit.flgSegnalazione}"/>
						</p:column>
						
						<p:column headerText="" style="text-align:center;">
							<p:commandButton id="btnAttiva" value="Attiva" disabled="#{schedaBean.disableModificaCartella || !compGit.attiva || !schedaBean.attivaSalvataggio}"
							action="#{parentiBean.attivaParente}" process="@this" update=":#{p:component('tabParenti')}"
							oncomplete="if (args &amp;&amp; args.canActivate) {  PF('wdgNewParente#{parentiBean.listaComponenti[0].id}').loadContents();  PF('wdgNewParente#{parentiBean.listaComponenti[0].id}').show()}">
								<f:setPropertyActionListener value="#{rowIndex}" target="#{parentiBean.idxSelected}" />
							</p:commandButton>
						</p:column>
						
					</p:dataTable>
					
					
					<h:panelGrid columns="1">
						<p:spacer height="20"/>
						<h:outputText value="Ricerca parente convivente in anagrafe popolazione" style="font-weight: bold;"/>	
						<p:spacer height="10"/>
					</h:panelGrid>
					
					<p:outputPanel >
					
					<webredcs:pnlUserSearch id="autoCompUserSearchId" styleClass="myAutoComplete" userManBean="#{parentiBean.userSearchNuovoParente}"  />
					<p:commandButton value="Inserisci parente trovato"	action="#{parentiBean.creaParenteTrovatoAnagrafica()}"
					                 process="@this" disabled="#{schedaBean.disableModificaCartella or !schedaBean.attivaSalvataggio}"  update="@parent:@parent" 
					                 oncomplete="if (args &amp;&amp; args.canActivate) {  PF('wdgNewParente#{parentiBean.listaComponenti[0].id}').loadContents();  PF('wdgNewParente#{parentiBean.listaComponenti[0].id}').show()}"/>
					</p:outputPanel>		
							
					<h:panelGrid columns="1">
						<p:spacer height="20"/>
						<p:spacer height="10"/>
					</h:panelGrid>
					
					<webredcs:pnlDataValiditaList iDatiValList="#{parentiBean}"
						dataValiditaStyleClass="accordionFooter"
						buttonFooterStyleClass="buttonFooter"
						disableModifica="#{schedaBean.disableModificaCartella}"
						isStatoAttivo="#{schedaBean.attivaSalvataggio}"/>
						
					<h:panelGrid columns="1">
						<p:spacer height="10"/>
						<h:outputLabel value="ATTENZIONE: I dati non salvati verranno persi" style="font-weight:bold;"/>
					</h:panelGrid>
				
			</p:tab>
			<p:tab id="tabDatiSociali" title="Dati Sociali" rendered="#{schedaBean.renderTabDatiSociali}">
				
					<webredcs:pnlDataValiditaList iDatiValList="#{datiSocialiBean}"
						dataValiditaStyleClass="accordionFooter"
						buttonFooterStyleClass="buttonFooter"
						disableModifica="#{schedaBean.disableModificaCartella}"
						isStatoAttivo="#{schedaBean.attivaSalvataggio}" />
						
					<h:panelGrid columns="1">
						<p:spacer height="10"/>
						<h:outputLabel value="ATTENZIONE: I dati non salvati verranno persi" style="font-weight:bold;"/>
					</h:panelGrid>

				
			</p:tab>
			<p:tab id="tabDatiInvalidita" title="Invalidita" titletip="Dati Invalidità" rendered="#{schedaBean.renderTabInvalidita}">
				<webredcs:pnlDataValiditaList iDatiValList="#{datiInvaliditaBean}"
						dataValiditaStyleClass="accordionFooter"
						buttonFooterStyleClass="buttonFooter"
						disableModifica="#{schedaBean.disableModificaCartella}"
						isStatoAttivo="#{schedaBean.attivaSalvataggio}"/>
				
					<h:panelGrid columns="1">
						<p:spacer height="10"/>
						<h:outputLabel value="ATTENZIONE: I dati non salvati verranno persi" style="font-weight:bold;"/>
					</h:panelGrid>

				
			</p:tab>
			<p:tab id="tabDatiDisabilita" title="Disabilità" titletip="Dati Disabilità" rendered="#{schedaBean.renderTabDisabilita}">
									
					<webredcs:pnlDataValiditaList iDatiValList="#{datiDisabilitaBean}"
						dataValiditaStyleClass="accordionFooter"
						buttonFooterStyleClass="buttonFooter"
						disableModifica="#{schedaBean.disableModificaCartella}"
						isStatoAttivo="#{schedaBean.attivaSalvataggio}"/>
						
					<h:panelGrid columns="1">
						<p:spacer height="10"/>
						<h:outputLabel value="ATTENZIONE: I dati non salvati verranno persi" style="font-weight:bold;"/>
					</h:panelGrid>

				
			</p:tab>
			<p:tab id="tabDatiTribunale" title="Tribunale" titletip="Dati Tribunale" rendered="#{schedaBean.renderTabTribunale}">
			
					<webredcs:pnlDataValiditaList iDatiValList="#{datiTribunaleBean}"
						dataValiditaStyleClass="accordionFooter"
						buttonFooterStyleClass="buttonFooter"
						disableModifica="#{schedaBean.disableModificaCartella}"
						isStatoAttivo="#{schedaBean.attivaSalvataggio}"/>
						
					<h:panelGrid columns="1">
						<p:spacer height="10"/>
						<h:outputLabel value="ATTENZIONE: I dati non salvati verranno persi" style="font-weight:bold;"/>
					</h:panelGrid>

			</p:tab>
			<p:tab id="tabServizi" title="Servizi" rendered="#{schedaBean.renderTabServizi}">
				
					<webredcs:pnlServizi id="pnlServizi" iServizi="#{serviziBean}" />
			
			</p:tab>
			<p:tab id="tabContributi" title="Contributi" rendered="#{schedaBean.renderTabContributi}">
			
					<webredcs:pnlContributi id="pnlContributi"
						iContributi="#{contributiBean}" />
			
			</p:tab>
			<p:tab id="tabOperatori" title="Operatori" rendered="#{schedaBean.renderTabOperatori}">
				
					<webredcs:pnlOperatori id="pnlOperatori"
						iOperatori="#{operatoriBean}" 
						disableModifica="#{schedaBean.disableModificaCartella}"
						isStatoAttivo="#{schedaBean.attivaSalvataggio}"/>
						
					<h:panelGrid columns="1">
						<p:spacer height="10"/>
						<h:outputLabel value="ATTENZIONE: I dati non salvati verranno persi" style="font-weight:bold;"/>
					</h:panelGrid>
			
			</p:tab>
			<p:tab id="tabNote" title="Note" rendered="#{schedaBean.renderTabNote}">
				
					<webredcs:pnlNote id="pnlNote" iNote="#{noteBean}" />
				
			</p:tab>
		</p:tabView>
		
	 	<p:tab id="tabSalva" >
	 	
				<h:panelGrid columns="1" styleClass="ui-widget-header"  style="text-align:center;width:100%;">
					
					<h:panelGrid columns="2" id="salvataggio" >
					<p:commandButton value="Salva" process="@form" disabled="#{!schedaBean.attivaSalvataggio}"
						actionListener="#{schedaBean.salva()}" update=":header,@form">
					<p:confirm header="Conferma" message="Procedere con il salvataggio?" icon="ui-icon-alert"/>
					
					</p:commandButton>
					
					
					<p:commandButton value="Esci" process="@this" disabled="#{!schedaBean.attivaSalvataggio}"
						action="#{schedaBean.disabilitaModifiche()}" update=":header,@form">
					<p:confirm header="Conferma" message="Sicuro di voler uscire dalla 'Modalità Modifica'?" icon="ui-icon-alert"/>
					</p:commandButton>
					</h:panelGrid>
				</h:panelGrid>
					
			
			       <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
						<h:panelGrid columns="2" styleClass="centerAlign">
				        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
				        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
				        </h:panelGrid>     
				    </p:confirmDialog>
				    
				    
		</p:tab>		
	</h:form>
	<p:spacer height="20"/>
	<h:form id="schedaPICForm">
	 	<p:panel collapsed="false" toggleable="true" header="Dati Di Presa In Carico" rendered="#{soggetto!=null and schedaBean.presaInCaricoBean.casoInfo!=null}">
	       	   <webredcs:pnlIterInfoStato 
		          iIterInfoStato="#{schedaBean.presaInCaricoBean.casoInfo}" widgetDialog="dlg" dialogToUpdate="#{p:component('modalDialogIter')}"
	                   openDialogListener="#{schedaBean.presaInCaricoBean.iterDialogMan.openDialog(soggetto.csACaso.id)}" />
			   <webredcs:pnlIterDialog id="pnlIterDialog" idModalIterDialog="modalDialogIter" iIterDialog="#{schedaBean.presaInCaricoBean.iterDialogMan}" 
			                           widgetVar="dlg" closeDialogActionListener="#{schedaBean.closeDialog}" />
	    </p:panel>
	 </h:form>
		
	</ui:define>

</ui:composition>

</html>